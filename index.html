
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Xiaoyao Qian</title>
  <meta name="author" content="Xiaoyao Qian">

  
  <meta name="description" content="One of my recent work involves parsing a large XML file(DBLP), and for each data record parsed, it needs to be inserted into the db. The data would &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://xiaoyao1991.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Xiaoyao Qian" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Xiaoyao Qian</a></h1>
  
    <h2>The nth Blog.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:xiaoyao1991.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/17/inserting-data-to-mysql-with-many-to-many-relationship/">Inserting Data to MySQL With Many-to-many Relationship</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-17T23:55:29-06:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>11:55 pm</span></time>
        
           | <a href="/blog/2013/12/17/inserting-data-to-mysql-with-many-to-many-relationship/#disqus_thread"
             data-disqus-identifier="http://xiaoyao1991.github.io/blog/2013/12/17/inserting-data-to-mysql-with-many-to-many-relationship/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of my recent work involves parsing a large XML file(DBLP), and for each data record parsed, it needs to be inserted into the db. The data would be populating into tables, and they are correlated with many-to-many relationship.</p>

<p>So, obviously there will be 3 tables:</p>

<ul>
<li>publications</li>
<li>authors</li>
<li>author_publication(with Foreign Key constraints on authors table and publications table)</li>
</ul>


<p>The first try:</p>

<ol>
<li>Insert publication to &lsquo;publications&rsquo;, take the last insert id</li>
<li>Query an id from &lsquo;authors&rsquo;</li>
<li>If step 2 returns an id(which means the author exist in the table), take that id; otherwise, insert the author to &lsquo;authors&rsquo;, take the last insert id</li>
<li>Take both id&rsquo;s and insert into &lsquo;author_publication&rsquo; table.</li>
</ol>


<p>This trial runs very slow&hellip; Because for every author, we will be executing at most 2 queries to the db, and the queries can be expensive as the db size grows larger. So, instead of executing 2 queries, I utilized the fact that author must be UNIQUE inside of &lsquo;authors&rsquo; table. Here&rsquo;s the second trial:</p>

<ol>
<li>Insert publication to &lsquo;publications&rsquo;, take the last insert id</li>
<li>Insert author to &lsquo;authors&rsquo; table and <code>ON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id);</code>, take the last insert id</li>
<li>Take both id&rsquo;s and insert into &lsquo;author_publication&rsquo; table.</li>
</ol>


<p>In this case, the second step would ensure that at most 1 query to the db. The details on <code>ON DUPLICATE KEY UPDATE</code> can be read from <a href="http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html">The MySQL Manual Page</a></p>

<p>I&rsquo;m not sure if the second trial provides the best performance here, but it indeed improve the performance significantly as compared to the first trial.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/14/pypy-and-numpy/">Pypy and Numpy</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-14T03:48:53-06:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>3:48 am</span></time>
        
           | <a href="/blog/2013/12/14/pypy-and-numpy/#disqus_thread"
             data-disqus-identifier="http://xiaoyao1991.github.io/blog/2013/12/14/pypy-and-numpy/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Pypy and numpy have always been trying to get along well. On one hand, numpy is one of the best scientific libraries in the Python world. And on the other hand, pypy improves the efficiency of the execution significantly.</p>

<p>I happened to start to switch from naive python interpreter to pypy due to some efficiency issue, and the performance boosting is tremendous. However, it took me some time to figure out how to make numpy work with pypy. Turns out the pypy dev team has just removed the numpypy(which is one of the numpy version in pypy) out of the code base. So we have to install the numpy as an individual module from the source provided by pypy.</p>

<p>If you are using virtualenv, which is a good practice:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pip install git+https://bitbucket.org/pypy/numpy.git</span></code></pre></td></tr></table></div></figure>


<p>Or directly download the fork and install:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://bitbucket.org/pypy/numpy.git  </span></code></pre></td></tr></table></div></figure>


<p></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd numpy  </span></code></pre></td></tr></table></div></figure>


<p></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pypy setup.py install  </span></code></pre></td></tr></table></div></figure>


<p>Note that the official numpy module cannot work with pypy, so you have to use the fork by pypy dev team.<br/>
You can always check <a href="http://buildbot.pypy.org/numpy-status/latest.html">http://buildbot.pypy.org/numpy-status/latest.html</a> to see which functions and models can be used within pypy. Great applause to pypy dev team. They are really making big progresses.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/17/inserting-data-to-mysql-with-many-to-many-relationship/">Inserting Data to MySQL With Many-to-many Relationship</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/14/pypy-and-numpy/">Pypy and Numpy</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Xiaoyao Qian -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'xiaoyao';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
